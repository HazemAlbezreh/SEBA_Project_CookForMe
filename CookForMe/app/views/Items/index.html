#{extends 'main.html' /}
#{set title:'Home' /}
<p />
<h1 class="mybasket">&{'items_txt_heading'}</h1>
<div class="basketItems" id="items">
	<table class="table table-hover text-center">
		<thead>
			<tr >
				<th class="text-center">&{'items_txt_name_col_header'}</th>
				<th class="text-center" >&{'items_txt_description_col_header'}</th>
				<th class="text-center">&{'items_txt_price_col_header'}</th>
				<th class="text-center"></th>
			</tr>
		</thead>
		<tbody>
		#{list items:items, as:'item'}
			<tr>
				<td >${item.name}</td>
				<td >${item.description}</td>
				<td>&euro;${item.price.format('0.00')}</td>
				<td>
					<a href="" onclick="return addItem(${item.id});">&{'items_lnk_buy'}</a>
				</td>
			</tr>
		#{/list}
		</tbody>
	</table>
	
	<div id="BasketItemsTemplateOutput">
<script id="basketItems_tmpl" type="text/javascript">

	 #{form @checkout()}
	 	<input class="button secondary checkout-submit button-block" type="submit" value="Proceed to Basket">
	#{/form}
			
</script>
</div>
	
</div>
<script type="text/JavaScript">   
	function checkout() {	
		console.log('checkout was clicked');
		//items.checkout();
		//#items.checkout();
 		$(Items.checkout());

		return false;
		
	}
</script> 

<script type="text/JavaScript">   
	function addItem(itemid) {	
		console.log('additem was clicked'+itemid);
		
		$.ajax({
            type: "POST",
            url: "/items/add/"+itemid,
            //data: {newname: newname}, 
  		     data: {},
  		     contentType: "text/xml",
  		     dataType: 'xml', 
  		     success: function(json) {
  		    	console.log('result='+json);
  		    	
  	   			$('#BasketItemsTemplateOutput').html(tmpl('basketItems_tmpl', {basketItems: json}));
	  	   		$('#basketTbl #priceCell').each(function() {
	  	   			$(this).formatCurrency({region: 'en-GB'});
	        	 });
  		     },
  		     error: function(json) {
  	   		     alert('fail: ' + json);
  	   			
  		     } 
  		 });	 
  		 
   	 return false; 
  	}	
	
	function removeItem(basketItemId) {
		$.ajax({
            type: "POST",
            url: "/items/remove/"+basketItemId,
  		     data: {},
  		     contentType: "application/json; charset=utf-8",
  		     dataType: "json", 
  		    success: function(json) {
  	   			$('#BasketItemsTemplateOutput').html(tmpl('basketItems_tmpl', {basketItems: json}));
  	   			$('#basketTbl #priceCell').each(function() {
	  	   			$(this).formatCurrency({region: 'en-GB'});
        	 	});
  		     },
  		     
  		     error: function(json) {
  	   		     alert('fail: ' + json); 
  		     } 
  		 });
   	 return false; 
  	}	
</script> 

